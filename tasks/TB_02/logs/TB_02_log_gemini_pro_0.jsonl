{"completion_tokens": 2270, "response": "reasoning='The task is to design a folded-cascode OTA (FC-OTA) and provide its netlist in a specific Spectre format. The design choices and netlist construction are as follows:\\n\\n1.  **Topology Selection**: A PMOS-input folded cascode topology was chosen. This configuration typically offers a good input common-mode range (ICMR) when operating with a positive supply (VDD) and ground (VSS), high gain, and good frequency response suitable for the specified performance targets.\\n\\n2.  **Bias Circuitry**:\\n    *   The `ibn10u` port is used as the primary bias input. An external 10\u00b5A DC current source is connected to this port. Inside the subcircuit, `M_NBIAS_REF` is a diode-connected NMOS transistor whose drain and gate are connected to `ibn10u`. The external current source sets the current through `M_NBIAS_REF`, and the `ibn10u` node voltage becomes the reference gate voltage for other NMOS current sources.\\n    *   Two PMOS bias voltages, `vbias_pcasc` and `vbias_ptail`, are generated internally. Each is created by an NMOS current source (biased by `ibn10u`) driving a diode-connected PMOS transistor (`M_PDIODE_CASC` for `vbias_pcasc`, `M_PDIODE_TAIL` for `vbias_ptail`).\\n    *   `vbias_pcasc` is used to bias the gates of the PMOS cascode transistors.\\n    *   `vbias_ptail` is used to bias the gate of the PMOS tail current source for the input differential pair.\\n\\n3.  **Main Amplifier Core**:\\n    *   **Input Stage**: A PMOS differential pair (`M_IN_P1`, `M_IN_N1`) with gates connected to `vip` and `vin` respectively. Their common source (`n_tail_source`) is fed by a PMOS tail current source (`M_TAIL_P`).\\n    *   **Folding Current Sources**: Two NMOS transistors (`M_FOLD_N_P`, `M_FOLD_N_N`) are used as current sources, biased by `ibn10u`. Their drains are connected to the drains of the input pair transistors (`n_fold_p`, `n_fold_n`). These define the current in the cascode branches and facilitate the current folding action.\\n    *   **Cascode Stage**: PMOS cascode transistors (`M_CASC_P_DIODE`, `M_CASC_P_OUT`) are stacked on top of the folding nodes. Their gates are biased by `vbias_pcasc`. `M_CASC_P_DIODE` is on the non-inverting path, and `M_CASC_P_OUT` is on the inverting path leading to the output `vout`.\\n    *   **Active Load**: An NMOS current mirror (`M_LOAD_N_DIODE`, `M_LOAD_N_OUT`) serves as the active load. `M_LOAD_N_DIODE` is diode-connected, its drain (`n_out_d`) also being the drain of `M_CASC_P_DIODE`. `M_LOAD_N_OUT` mirrors this current to the output branch, with its drain connected to `vout`.\\n\\n4.  **Sizing Strategy**: Transistor W/L values are chosen based on an estimated current distribution aiming for a total DC current below 150\u00b5A, while providing a basis for achieving the performance specifications. Currents are: Reference current = 10\u00b5A; Tail current = 40\u00b5A (20\u00b5A per input device); NMOS folding branch current = 30\u00b5A; Resulting cascode/load current = 10\u00b5A. Lengths are generally set to 1\u00b5m for cascodes and current sources (for good output impedance and matching) and 0.5\u00b5m for the input pair (for higher gm/Id and fT). `as`, `ad`, `ps`, `pd` parameters are estimated based on W and a nominal diffusion extension (0.5\u00b5m width for area calculation, 0.5\u00b5m overlap for perimeter calculation).\\n\\n5.  **Port Usage**: All specified ports (`VDD`, `VSS`, `ibn10u`, `vin`, `vip`, `vout`) are explicitly used in the subcircuit as required.\\n\\n6.  **Netlist Format**: The generated netlist adheres strictly to the provided template for header/footer comments, subcircuit definition, top-level instantiation, and technology model names (`tsmc18dN` for NMOS, `tsmc18dP` for PMOS).' config=ConfigFile(netlist='// Library name: MP4\\n// Cell name: fc_ota\\n// View name: schematic\\nsubckt fc_ota VDD VSS ibn10u vin vip vout\\n    // Bias Generation Circuit\\n    M_NBIAS_REF (ibn10u ibn10u VSS VSS) tsmc18dN w=10u l=1u as=5e-12 ad=5e-12 ps=21u pd=21u m=1 region=sat\\n    M_N_FOR_PCASC_BIAS (vbias_pcasc ibn10u VSS VSS) tsmc18dN w=10u l=1u as=5e-12 ad=5e-12 ps=21u pd=21u m=1 region=sat\\n    M_PDIODE_CASC (vbias_pcasc vbias_pcasc VDD VDD) tsmc18dP w=20u l=1u as=10e-12 ad=10e-12 ps=41u pd=41u m=1 region=sat\\n    M_N_FOR_PTAIL_BIAS (vbias_ptail ibn10u VSS VSS) tsmc18dN w=10u l=1u as=5e-12 ad=5e-12 ps=21u pd=21u m=1 region=sat\\n    M_PDIODE_TAIL (vbias_ptail vbias_ptail VDD VDD) tsmc18dP w=20u l=1u as=10e-12 ad=10e-12 ps=41u pd=41u m=1 region=sat\\n\\n    // Main Amplifier Core\\n    // Input Stage\\n    M_TAIL_P (n_tail_source vbias_ptail VDD VDD) tsmc18dP w=80u l=1u as=40e-12 ad=40e-12 ps=161u pd=161u m=1 region=sat\\n    M_IN_P1 (n_fold_p vip n_tail_source VDD) tsmc18dP w=100u l=0.5u as=50e-12 ad=50e-12 ps=201u pd=201u m=1 region=sat\\n    M_IN_N1 (n_fold_n vin n_tail_source VDD) tsmc18dP w=100u l=0.5u as=50e-12 ad=50e-12 ps=201u pd=201u m=1 region=sat\\n\\n    // Folding NMOS Current Sources\\n    M_FOLD_N_P (n_fold_p ibn10u VSS VSS) tsmc18dN w=30u l=1u as=15e-12 ad=15e-12 ps=61u pd=61u m=1 region=sat\\n    M_FOLD_N_N (n_fold_n ibn10u VSS VSS) tsmc18dN w=30u l=1u as=15e-12 ad=15e-12 ps=61u pd=61u m=1 region=sat\\n\\n    // PMOS Cascode Stage\\n    M_CASC_P_DIODE (n_out_d n_fold_p vbias_pcasc VDD) tsmc18dP w=40u l=1u as=20e-12 ad=20e-12 ps=81u pd=81u m=1 region=sat\\n    M_CASC_P_OUT (vout n_fold_n vbias_pcasc VDD) tsmc18dP w=40u l=1u as=20e-12 ad=20e-12 ps=81u pd=81u m=1 region=sat\\n\\n    // NMOS Active Load\\n    M_LOAD_N_DIODE (n_out_d n_out_d VSS VSS) tsmc18dN w=10u l=1u as=5e-12 ad=5e-12 ps=21u pd=21u m=1 region=sat\\n    M_LOAD_N_OUT (vout n_out_d VSS VSS) tsmc18dN w=10u l=1u as=5e-12 ad=5e-12 ps=21u pd=21u m=1 region=sat\\nends fc_ota\\n// Top-level instantiation\\n// Library name: MP4\\n// Cell name: dut\\n// View name: schematic\\nI1 (net1 net2 net5 net3 net4 net6) fc_ota')", "passed": false, "evaluation_result": {"error": "one or more metrics missing", "metrics": {"dc_gain_db": -80.44, "ugf_mhz": 0.0, "pm_deg": null, "icmr_v": 0.0, "io_err_mv": 586.183, "idc_ua": 0.0}, "score": 0, "passed": false}, "score": 0}
